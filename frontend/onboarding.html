<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¬¢è¿ä½¿ç”¨ MindPal</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/animations.css">

  <style>
    .onboarding-page {
      min-height: 100vh;
      background: var(--color-bg-dark);
      display: flex;
      flex-direction: column;
    }

    /* é¡¶éƒ¨è¿›åº¦æ¡ */
    .progress-bar {
      height: 4px;
      background: var(--color-border);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: var(--z-dropdown);
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-primary);
      width: 0%;
      transition: width var(--duration-normal) var(--ease-out);
    }

    /* ä¸»å®¹å™¨ */
    .onboarding-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-2xl) var(--spacing-md);
      position: relative;
    }

    /* æ­¥éª¤å®¹å™¨ */
    .step-container {
      width: 100%;
      max-width: 600px;
      display: none;
      animation: fadeIn var(--duration-normal) var(--ease-out);
    }

    .step-container.active {
      display: block;
    }

    /* æ­¥éª¤æ ‡é¢˜ */
    .step-header {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
    }

    .step-number {
      display: inline-block;
      width: 48px;
      height: 48px;
      background: var(--gradient-primary);
      border-radius: var(--radius-full);
      font-size: var(--font-size-h4);
      font-weight: var(--font-weight-bold);
      color: #FFFFFF;
      line-height: 48px;
      margin-bottom: var(--spacing-md);
      box-shadow: var(--shadow-glow);
    }

    .step-title {
      font-size: var(--font-size-h2);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-sm);
    }

    .step-description {
      font-size: var(--font-size-body-large);
      color: var(--color-text-secondary);
      line-height: var(--line-height-body-large);
    }

    /* æ­¥éª¤å†…å®¹ */
    .step-content {
      background: var(--color-bg-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: var(--radius-xl);
      padding: var(--spacing-2xl);
      box-shadow: var(--shadow-lg);
      margin-bottom: var(--spacing-xl);
    }

    /* é€‰é¡¹å¡ç‰‡ */
    .option-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }

    .option-card {
      background: rgba(30, 41, 59, 0.6);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      text-align: center;
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-in-out);
    }

    .option-card:hover {
      border-color: var(--color-primary-1);
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
    }

    .option-card.selected {
      border-color: var(--color-primary-1);
      background: rgba(99, 102, 241, 0.1);
      box-shadow: var(--shadow-glow);
    }

    .option-icon {
      font-size: 48px;
      margin-bottom: var(--spacing-sm);
    }

    .option-label {
      font-size: var(--font-size-body-large);
      color: var(--color-text-primary);
      font-weight: var(--font-weight-medium);
    }

    /* è¡¨å•ç»„ */
    .form-group {
      margin-bottom: var(--spacing-lg);
    }

    .form-label {
      display: block;
      font-size: var(--font-size-body-large);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-sm);
      font-weight: var(--font-weight-medium);
    }

    .form-input,
    .form-textarea {
      width: 100%;
      padding: 12px 16px;
      font-size: var(--font-size-body-large);
      color: var(--color-text-primary);
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      transition: all var(--duration-fast) var(--ease-in-out);
    }

    .form-input {
      height: 48px;
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
      font-family: inherit;
    }

    .form-input::placeholder,
    .form-textarea::placeholder {
      color: var(--color-text-placeholder);
    }

    .form-input:focus,
    .form-textarea:focus {
      border-color: var(--color-primary-1);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      outline: none;
    }

    /* åº•éƒ¨æŒ‰é’® */
    .step-actions {
      display: flex;
      gap: var(--spacing-md);
      justify-content: space-between;
    }

    .btn-back {
      flex: 1;
      max-width: 120px;
    }

    .btn-next {
      flex: 1;
    }

    .btn-skip {
      background: transparent;
      color: var(--color-text-secondary);
      border: none;
      padding: 12px 24px;
      cursor: pointer;
      transition: color var(--duration-fast) var(--ease-in-out);
    }

    .btn-skip:hover {
      color: var(--color-primary-1);
    }

    /* æ¬¢è¿é¡µç‰¹æ®Šæ ·å¼ */
    .welcome-illustration {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
    }

    .welcome-icon {
      font-size: 120px;
      animation: float 3s ease-in-out infinite;
    }

    .feature-list {
      list-style: none;
      margin: var(--spacing-xl) 0;
    }

    .feature-item {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-md);
      padding: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
      background: rgba(30, 41, 59, 0.4);
      border-radius: var(--radius-md);
      animation: slideInFromLeft var(--duration-normal) var(--ease-custom);
    }

    .feature-item:nth-child(1) { animation-delay: 0ms; }
    .feature-item:nth-child(2) { animation-delay: 100ms; }
    .feature-item:nth-child(3) { animation-delay: 200ms; }
    .feature-item:nth-child(4) { animation-delay: 300ms; }

    .feature-icon {
      font-size: 32px;
      flex-shrink: 0;
    }

    .feature-text h4 {
      font-size: var(--font-size-body-large);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .feature-text p {
      font-size: var(--font-size-body);
      color: var(--color-text-secondary);
      line-height: var(--line-height-body);
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .onboarding-container {
        padding: var(--spacing-lg) var(--spacing-md);
      }

      .step-content {
        padding: var(--spacing-lg);
      }

      .option-grid {
        grid-template-columns: 1fr;
      }

      .welcome-icon {
        font-size: 80px;
      }
    }
  </style>
</head>
<body>
  <div class="onboarding-page page-transition">
    <!-- è¿›åº¦æ¡ -->
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="onboarding-container">
      <!-- æ­¥éª¤1: æ¬¢è¿ -->
      <div class="step-container active" data-step="1">
        <div class="step-header">
          <div class="step-number">1</div>
          <h2 class="step-title gradient-text">æ¬¢è¿æ¥åˆ° MindPal</h2>
          <p class="step-description">ä½ çš„ä¸“å±æ•°å­—çµé­‚ä¼´ä¾£</p>
        </div>

        <div class="step-content">
          <div class="welcome-illustration">
            <div class="welcome-icon">ğŸ§ âœ¨</div>
          </div>

          <ul class="feature-list">
            <li class="feature-item">
              <span class="feature-icon">ğŸ’¬</span>
              <div class="feature-text">
                <h4>æ™ºèƒ½å¯¹è¯</h4>
                <p>24å°æ—¶é™ªä¼´èŠå¤©ï¼Œç†è§£ä½ çš„æƒ…ç»ªï¼Œç»™äºˆæ¸©æš–å›åº”</p>
              </div>
            </li>
            <li class="feature-item">
              <span class="feature-icon">ğŸ§ </span>
              <div class="feature-text">
                <h4>çŸ¥è¯†æœåŠ¡</h4>
                <p>ä¸Šä¼ æ–‡æ¡£èµ„æ–™ï¼Œéšæ—¶æŸ¥è¯¢çŸ¥è¯†ï¼Œæå‡å­¦ä¹ æ•ˆç‡</p>
              </div>
            </li>
            <li class="feature-item">
              <span class="feature-icon">ğŸ›ï¸</span>
              <div class="feature-text">
                <h4>è´­ç‰©åŠ©æ‰‹</h4>
                <p>æ™ºèƒ½æ¨èå•†å“ï¼Œæ¯”ä»·åŠ©æ‰‹ï¼Œè®©è´­ç‰©æ›´è½»æ¾</p>
              </div>
            </li>
            <li class="feature-item">
              <span class="feature-icon">ğŸ­</span>
              <div class="feature-text">
                <h4>ä¸ªæ€§å®šåˆ¶</h4>
                <p>è‡ªå®šä¹‰æ•°å­—äººå½¢è±¡ã€æ€§æ ¼ã€å£°éŸ³ï¼Œæ‰“é€ ä¸“å±ä¼´ä¾£</p>
              </div>
            </li>
          </ul>
        </div>

        <div class="step-actions">
          <button class="btn btn-primary btn-next" onclick="nextStep()">
            å¼€å§‹ä½“éªŒ
          </button>
        </div>
      </div>

      <!-- æ­¥éª¤2: é€‰æ‹©ä½¿ç”¨åœºæ™¯ -->
      <div class="step-container" data-step="2">
        <div class="step-header">
          <div class="step-number">2</div>
          <h2 class="step-title">ä½ ä¸»è¦æƒ³ç”¨ MindPal åšä»€ä¹ˆï¼Ÿ</h2>
          <p class="step-description">å¯ä»¥é€‰æ‹©å¤šä¸ªé€‰é¡¹</p>
        </div>

        <div class="step-content">
          <div class="option-grid">
            <div class="option-card" data-value="chat" onclick="toggleOption(this)">
              <div class="option-icon">ğŸ’¬</div>
              <div class="option-label">æƒ…æ„Ÿé™ªä¼´</div>
            </div>
            <div class="option-card" data-value="knowledge" onclick="toggleOption(this)">
              <div class="option-icon">ğŸ“š</div>
              <div class="option-label">çŸ¥è¯†æŸ¥è¯¢</div>
            </div>
            <div class="option-card" data-value="shopping" onclick="toggleOption(this)">
              <div class="option-icon">ğŸ›’</div>
              <div class="option-label">è´­ç‰©åŠ©æ‰‹</div>
            </div>
            <div class="option-card" data-value="learning" onclick="toggleOption(this)">
              <div class="option-icon">ğŸ“</div>
              <div class="option-label">å­¦ä¹ è¾…å¯¼</div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-secondary btn-back" onclick="prevStep()">
            ä¸Šä¸€æ­¥
          </button>
          <button class="btn btn-primary btn-next" onclick="nextStep()">
            ä¸‹ä¸€æ­¥
          </button>
        </div>
      </div>

      <!-- æ­¥éª¤3: é€‰æ‹©æ•°å­—äººç±»å‹ -->
      <div class="step-container" data-step="3">
        <div class="step-header">
          <div class="step-number">3</div>
          <h2 class="step-title">æƒ³è¦ä»€ä¹ˆæ ·çš„æ•°å­—äººé™ªä¼´ä½ ï¼Ÿ</h2>
          <p class="step-description">é€‰æ‹©ä¸€ä¸ªä½ å–œæ¬¢çš„ç±»å‹</p>
        </div>

        <div class="step-content">
          <div class="option-grid">
            <div class="option-card" data-value="gentle" onclick="selectSingleOption(this, 'personality')">
              <div class="option-icon">ğŸ˜Š</div>
              <div class="option-label">æ¸©æŸ”ä½“è´´</div>
            </div>
            <div class="option-card" data-value="energetic" onclick="selectSingleOption(this, 'personality')">
              <div class="option-icon">ğŸ˜„</div>
              <div class="option-label">æ´»æ³¼å¼€æœ—</div>
            </div>
            <div class="option-card" data-value="intellectual" onclick="selectSingleOption(this, 'personality')">
              <div class="option-icon">ğŸ¤“</div>
              <div class="option-label">çŸ¥æ€§ç†æ€§</div>
            </div>
            <div class="option-card" data-value="humorous" onclick="selectSingleOption(this, 'personality')">
              <div class="option-icon">ğŸ˜†</div>
              <div class="option-label">å¹½é»˜é£è¶£</div>
            </div>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-secondary btn-back" onclick="prevStep()">
            ä¸Šä¸€æ­¥
          </button>
          <button class="btn btn-primary btn-next" onclick="nextStep()">
            ä¸‹ä¸€æ­¥
          </button>
        </div>
      </div>

      <!-- æ­¥éª¤4: ä¸ªæ€§åŒ–è®¾ç½® -->
      <div class="step-container" data-step="4">
        <div class="step-header">
          <div class="step-number">4</div>
          <h2 class="step-title">ç»™ä½ çš„æ•°å­—äººèµ·ä¸ªåå­—å§</h2>
          <p class="step-description">ä¹Ÿå¯ä»¥å‘Šè¯‰æˆ‘ä»¬æ›´å¤šä½ çš„éœ€æ±‚</p>
        </div>

        <div class="step-content">
          <div class="form-group">
            <label class="form-label" for="dhName">æ•°å­—äººæ˜µç§°</label>
            <input
              type="text"
              id="dhName"
              class="form-input"
              placeholder="ä¾‹å¦‚ï¼šå°æ™ºã€å°é›…ã€é˜¿æ˜Ÿ..."
              maxlength="20"
            >
          </div>

          <div class="form-group">
            <label class="form-label" for="userNeeds">ä½ çš„éœ€æ±‚æˆ–æœŸå¾…ï¼ˆå¯é€‰ï¼‰</label>
            <textarea
              id="userNeeds"
              class="form-textarea"
              placeholder="å‘Šè¯‰æˆ‘ä»¬ä½ å¸Œæœ›æ•°å­—äººå¸®ä½ åšä»€ä¹ˆï¼Œæˆ–è€…ä½ å¯¹å®ƒæœ‰ä»€ä¹ˆæœŸå¾…..."
            ></textarea>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn btn-secondary btn-back" onclick="prevStep()">
            ä¸Šä¸€æ­¥
          </button>
          <button class="btn btn-primary btn-next" onclick="completeOnboarding()">
            å®Œæˆè®¾ç½®
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentStep = 1;
    const totalSteps = 4;
    let onboardingData = {
      scenarios: [],
      personality: '',
      dhName: '',
      userNeeds: ''
    };

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress() {
      const progress = (currentStep / totalSteps) * 100;
      document.getElementById('progressFill').style.width = `${progress}%`;
    }

    // æ˜¾ç¤ºæŒ‡å®šæ­¥éª¤
    function showStep(stepNumber) {
      document.querySelectorAll('.step-container').forEach(container => {
        container.classList.remove('active');
      });

      const targetStep = document.querySelector(`[data-step="${stepNumber}"]`);
      if (targetStep) {
        targetStep.classList.add('active');
        currentStep = stepNumber;
        updateProgress();
      }
    }

    // ä¸‹ä¸€æ­¥
    function nextStep() {
      if (currentStep < totalSteps) {
        // éªŒè¯å½“å‰æ­¥éª¤
        if (!validateStep(currentStep)) {
          return;
        }

        // ä¿å­˜å½“å‰æ­¥éª¤æ•°æ®
        saveStepData(currentStep);

        showStep(currentStep + 1);
      }
    }

    // ä¸Šä¸€æ­¥
    function prevStep() {
      if (currentStep > 1) {
        showStep(currentStep - 1);
      }
    }

    // éªŒè¯æ­¥éª¤
    function validateStep(step) {
      if (step === 2) {
        const selected = document.querySelectorAll('[data-step="2"] .option-card.selected');
        if (selected.length === 0) {
          alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªä½¿ç”¨åœºæ™¯');
          return false;
        }
      }

      if (step === 3) {
        const selected = document.querySelector('[data-step="3"] .option-card.selected');
        if (!selected) {
          alert('è¯·é€‰æ‹©ä¸€ä¸ªæ•°å­—äººç±»å‹');
          return false;
        }
      }

      return true;
    }

    // ä¿å­˜æ­¥éª¤æ•°æ®
    function saveStepData(step) {
      if (step === 2) {
        const selected = document.querySelectorAll('[data-step="2"] .option-card.selected');
        onboardingData.scenarios = Array.from(selected).map(card => card.dataset.value);
      }

      if (step === 3) {
        const selected = document.querySelector('[data-step="3"] .option-card.selected');
        if (selected) {
          onboardingData.personality = selected.dataset.value;
        }
      }

      if (step === 4) {
        onboardingData.dhName = document.getElementById('dhName').value.trim();
        onboardingData.userNeeds = document.getElementById('userNeeds').value.trim();
      }
    }

    // åˆ‡æ¢é€‰é¡¹ï¼ˆå¤šé€‰ï¼‰
    function toggleOption(element) {
      element.classList.toggle('selected');
    }

    // å•é€‰é€‰é¡¹
    function selectSingleOption(element, group) {
      const stepContainer = element.closest('.step-container');
      stepContainer.querySelectorAll('.option-card').forEach(card => {
        card.classList.remove('selected');
      });
      element.classList.add('selected');
    }

    // å®Œæˆå¼•å¯¼
    async function completeOnboarding() {
      // ä¿å­˜æœ€åä¸€æ­¥æ•°æ®
      saveStepData(4);

      const dhName = onboardingData.dhName;
      if (!dhName) {
        alert('è¯·ç»™ä½ çš„æ•°å­—äººèµ·ä¸ªåå­—');
        return;
      }

      // æ¨¡æ‹Ÿåˆ›å»ºæ•°å­—äºº
      const btn = document.querySelector('[data-step="4"] .btn-next');
      btn.classList.add('btn-loading');
      btn.disabled = true;

      try {
        // æ¨¡æ‹ŸAPIè°ƒç”¨
        await new Promise(resolve => setTimeout(resolve, 1500));

        // åˆ›å»ºé»˜è®¤æ•°å­—äºº
        const digitalHuman = {
          id: Date.now(),
          name: dhName,
          avatar: 'ğŸ‘¤',
          personality: onboardingData.personality || 'gentle',
          scenarios: onboardingData.scenarios,
          userNeeds: onboardingData.userNeeds,
          createdAt: new Date().toISOString()
        };

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        const digitalHumans = JSON.parse(localStorage.getItem('mindpal_digital_humans') || '[]');
        digitalHumans.push(digitalHuman);
        localStorage.setItem('mindpal_digital_humans', JSON.stringify(digitalHumans));

        // æ ‡è®°å·²å®Œæˆå¼•å¯¼
        localStorage.setItem('mindpal_onboarded', 'true');
        localStorage.setItem('mindpal_onboarding_data', JSON.stringify(onboardingData));

        // è·³è½¬åˆ°æ•°å­—äººåˆ—è¡¨é¡µ
        window.location.href = 'dh-list.html';

      } catch (error) {
        console.error('åˆ›å»ºå¤±è´¥:', error);
        alert('åˆ›å»ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        btn.classList.remove('btn-loading');
        btn.disabled = false;
      }
    }

    // åˆå§‹åŒ–
    window.addEventListener('load', function() {
      updateProgress();
    });
  </script>
</body>
</html>
