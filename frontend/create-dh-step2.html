<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åˆ›å»ºæ•°å­—äºº - è®¾ç½®æ€§æ ¼</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/animations.css">

  <style>
    .create-page {
      min-height: 100vh;
      background: var(--color-bg-dark);
      display: flex;
      flex-direction: column;
    }

    .top-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-md) var(--spacing-2xl);
      background: var(--color-bg-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      position: sticky;
      top: 0;
      z-index: var(--z-dropdown);
    }

    .nav-back {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: var(--color-text-secondary);
      text-decoration: none;
      font-size: var(--font-size-body-large);
      transition: color var(--duration-fast) var(--ease-in-out);
    }

    .nav-back:hover {
      color: var(--color-primary-1);
    }

    .nav-title {
      font-size: var(--font-size-h4);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
    }

    .create-stepper {
      padding: var(--spacing-xl) var(--spacing-2xl);
      background: var(--color-bg-dark);
    }

    .create-content {
      flex: 1;
      padding: var(--spacing-2xl);
      max-width: 1000px;
      width: 100%;
      margin: 0 auto;
    }

    .content-header {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
    }

    .content-title {
      font-size: var(--font-size-h2);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-sm);
    }

    .content-description {
      font-size: var(--font-size-body-large);
      color: var(--color-text-secondary);
    }

    /* æ€§æ ¼ç±»å‹å¡ç‰‡ */
    .personality-section {
      margin-bottom: var(--spacing-2xl);
    }

    .section-title {
      font-size: var(--font-size-h4);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-md);
    }

    .personality-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-xl);
    }

    .personality-card {
      background: var(--color-bg-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 2px solid rgba(148, 163, 184, 0.2);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-in-out);
      position: relative;
    }

    .personality-card:hover {
      border-color: var(--color-primary-1);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .personality-card.selected {
      border-color: var(--color-primary-1);
      background: rgba(99, 102, 241, 0.1);
      box-shadow: var(--shadow-glow);
    }

    .personality-card.selected::after {
      content: 'âœ“';
      position: absolute;
      top: 12px;
      right: 12px;
      width: 24px;
      height: 24px;
      background: var(--gradient-primary);
      color: #FFFFFF;
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-body-small);
    }

    .personality-icon {
      font-size: 40px;
      margin-bottom: var(--spacing-sm);
    }

    .personality-name {
      font-size: var(--font-size-body-large);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .personality-desc {
      font-size: var(--font-size-body-small);
      color: var(--color-text-secondary);
      line-height: var(--line-height-body);
    }

    /* æ€§æ ¼ç‰¹è´¨è°ƒèŠ‚ */
    .traits-section {
      background: var(--color-bg-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: var(--radius-xl);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
    }

    .trait-item {
      margin-bottom: var(--spacing-lg);
    }

    .trait-item:last-child {
      margin-bottom: 0;
    }

    .trait-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-sm);
    }

    .trait-label {
      font-size: var(--font-size-body-large);
      color: var(--color-text-primary);
      font-weight: var(--font-weight-medium);
    }

    .trait-value {
      font-size: var(--font-size-body);
      color: var(--color-primary-1);
      font-weight: var(--font-weight-semibold);
      min-width: 40px;
      text-align: right;
    }

    .trait-slider {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(30, 41, 59, 0.6);
      border-radius: var(--radius-full);
      outline: none;
      cursor: pointer;
    }

    .trait-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: var(--gradient-primary);
      border-radius: var(--radius-full);
      cursor: pointer;
      box-shadow: var(--shadow-glow);
      transition: transform var(--duration-fast) var(--ease-out);
    }

    .trait-slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    .trait-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: var(--gradient-primary);
      border: none;
      border-radius: var(--radius-full);
      cursor: pointer;
      box-shadow: var(--shadow-glow);
      transition: transform var(--duration-fast) var(--ease-out);
    }

    .trait-slider::-moz-range-thumb:hover {
      transform: scale(1.2);
    }

    .trait-description {
      display: flex;
      justify-content: space-between;
      margin-top: var(--spacing-xs);
    }

    .trait-desc-left,
    .trait-desc-right {
      font-size: var(--font-size-body-small);
      color: var(--color-text-disabled);
    }

    /* è‡ªå®šä¹‰æè¿° */
    .custom-section {
      background: var(--color-bg-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: var(--radius-xl);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
    }

    .custom-textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px 16px;
      font-size: var(--font-size-body-large);
      color: var(--color-text-primary);
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      resize: vertical;
      font-family: inherit;
      line-height: 1.6;
      transition: all var(--duration-fast) var(--ease-in-out);
    }

    .custom-textarea::placeholder {
      color: var(--color-text-placeholder);
    }

    .custom-textarea:focus {
      border-color: var(--color-primary-1);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      outline: none;
    }

    .create-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-lg) var(--spacing-2xl);
      background: var(--color-bg-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid rgba(148, 163, 184, 0.2);
      position: sticky;
      bottom: 0;
    }

    .footer-left {
      display: flex;
      gap: var(--spacing-md);
    }

    .footer-right {
      display: flex;
      gap: var(--spacing-md);
    }

    @media (max-width: 768px) {
      .top-nav,
      .create-stepper,
      .create-content,
      .create-footer {
        padding-left: var(--spacing-md);
        padding-right: var(--spacing-md);
      }

      .personality-grid {
        grid-template-columns: 1fr;
      }

      .create-footer {
        flex-direction: column;
        gap: var(--spacing-md);
      }

      .footer-left,
      .footer-right {
        width: 100%;
      }

      .footer-right {
        flex-direction: row-reverse;
      }

      .footer-right .btn {
        flex: 1;
      }
    }
  </style>
</head>
<body>
  <div class="create-page page-transition">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="top-nav">
      <a href="create-dh-step1.html" class="nav-back">
        <span>â†</span>
        <span>è¿”å›</span>
      </a>
      <h2 class="nav-title">åˆ›å»ºæ•°å­—äºº</h2>
      <div style="width: 60px;"></div>
    </nav>

    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="create-stepper">
      <div class="stepper">
        <div class="step completed">
          <div class="step-circle">1</div>
          <div class="step-label">é€‰æ‹©å½¢è±¡</div>
        </div>
        <div class="step-line"></div>
        <div class="step active">
          <div class="step-circle">2</div>
          <div class="step-label">è®¾ç½®æ€§æ ¼</div>
        </div>
        <div class="step-line"></div>
        <div class="step">
          <div class="step-circle">3</div>
          <div class="step-label">é€‰æ‹©å£°éŸ³</div>
        </div>
        <div class="step-line"></div>
        <div class="step">
          <div class="step-circle">4</div>
          <div class="step-label">è®¾ç½®çŸ¥è¯†åº“</div>
        </div>
        <div class="step-line"></div>
        <div class="step">
          <div class="step-circle">5</div>
          <div class="step-label">ç¡®è®¤åˆ›å»º</div>
        </div>
      </div>
    </div>

    <!-- ä¸»å†…å®¹ -->
    <div class="create-content">
      <div class="content-header">
        <h1 class="content-title gradient-text">è®¾ç½®æ•°å­—äººæ€§æ ¼</h1>
        <p class="content-description">é€‰æ‹©ä¸€ä¸ªæ€§æ ¼ç±»å‹ï¼Œæˆ–è‡ªå®šä¹‰æ€§æ ¼ç‰¹è´¨</p>
      </div>

      <!-- æ€§æ ¼ç±»å‹é€‰æ‹© -->
      <div class="personality-section">
        <h3 class="section-title">é€‰æ‹©æ€§æ ¼ç±»å‹</h3>
        <div class="personality-grid">
          <div class="personality-card" data-personality="gentle" onclick="selectPersonality(this)">
            <div class="personality-icon">ğŸ˜Š</div>
            <div class="personality-name">æ¸©æŸ”ä½“è´´</div>
            <div class="personality-desc">å–„è§£äººæ„ï¼Œæ¸©æš–ç»†è…»ï¼Œæ€»æ˜¯ç»™äºˆå…³æ€€å’Œæ”¯æŒ</div>
          </div>

          <div class="personality-card" data-personality="energetic" onclick="selectPersonality(this)">
            <div class="personality-icon">ğŸ˜„</div>
            <div class="personality-name">æ´»æ³¼å¼€æœ—</div>
            <div class="personality-desc">çƒ­æƒ…æ´‹æº¢ï¼Œå……æ»¡æ´»åŠ›ï¼Œèƒ½å¸¦æ¥æ¬¢ä¹å’Œæ­£èƒ½é‡</div>
          </div>

          <div class="personality-card" data-personality="intellectual" onclick="selectPersonality(this)">
            <div class="personality-icon">ğŸ¤“</div>
            <div class="personality-name">çŸ¥æ€§ç†æ€§</div>
            <div class="personality-desc">é€»è¾‘æ¸…æ™°ï¼Œç†æ€§å®¢è§‚ï¼Œå–„äºåˆ†æå’Œè§£å†³é—®é¢˜</div>
          </div>

          <div class="personality-card" data-personality="humorous" onclick="selectPersonality(this)">
            <div class="personality-icon">ğŸ˜†</div>
            <div class="personality-name">å¹½é»˜é£è¶£</div>
            <div class="personality-desc">æœºæ™ºè¯™è°ï¼Œå¦™è¯­è¿ç ï¼Œæ€»èƒ½é€—ä½ å¼€å¿ƒ</div>
          </div>

          <div class="personality-card" data-personality="calm" onclick="selectPersonality(this)">
            <div class="personality-icon">ğŸ˜Œ</div>
            <div class="personality-name">æ²‰ç¨³å†·é™</div>
            <div class="personality-desc">æˆç†Ÿç¨³é‡ï¼Œé‡äº‹ä¸æ…Œï¼Œç»™äººå®‰å…¨æ„Ÿ</div>
          </div>

          <div class="personality-card" data-personality="creative" onclick="selectPersonality(this)">
            <div class="personality-icon">ğŸ¨</div>
            <div class="personality-name">å¯Œæœ‰åˆ›æ„</div>
            <div class="personality-desc">æƒ³è±¡åŠ›ä¸°å¯Œï¼Œæ€ç»´è·³è·ƒï¼Œæ€»æœ‰æ–°å¥‡æƒ³æ³•</div>
          </div>
        </div>
      </div>

      <!-- æ€§æ ¼ç‰¹è´¨è°ƒèŠ‚ -->
      <div class="traits-section">
        <h3 class="section-title">è°ƒæ•´æ€§æ ¼ç‰¹è´¨</h3>

        <div class="trait-item">
          <div class="trait-header">
            <span class="trait-label">æ´»æ³¼åº¦</span>
            <span class="trait-value" id="livelinessValue">50</span>
          </div>
          <input type="range" class="trait-slider" id="liveliness" min="0" max="100" value="50" oninput="updateTrait('liveliness', this.value)">
          <div class="trait-description">
            <span class="trait-desc-left">æ²‰ç¨³å†…æ•›</span>
            <span class="trait-desc-right">æ´»æ³¼å¤–å‘</span>
          </div>
        </div>

        <div class="trait-item">
          <div class="trait-header">
            <span class="trait-label">å¹½é»˜æ„Ÿ</span>
            <span class="trait-value" id="humorValue">50</span>
          </div>
          <input type="range" class="trait-slider" id="humor" min="0" max="100" value="50" oninput="updateTrait('humor', this.value)">
          <div class="trait-description">
            <span class="trait-desc-left">ä¸¥è‚ƒæ­£ç»</span>
            <span class="trait-desc-right">å¹½é»˜æç¬‘</span>
          </div>
        </div>

        <div class="trait-item">
          <div class="trait-header">
            <span class="trait-label">åŒç†å¿ƒ</span>
            <span class="trait-value" id="empathyValue">50</span>
          </div>
          <input type="range" class="trait-slider" id="empathy" min="0" max="100" value="50" oninput="updateTrait('empathy', this.value)">
          <div class="trait-description">
            <span class="trait-desc-left">ç†æ€§å®¢è§‚</span>
            <span class="trait-desc-right">æ„Ÿæ€§å…±æƒ…</span>
          </div>
        </div>

        <div class="trait-item">
          <div class="trait-header">
            <span class="trait-label">ä¸»åŠ¨æ€§</span>
            <span class="trait-value" id="initiativeValue">50</span>
          </div>
          <input type="range" class="trait-slider" id="initiative" min="0" max="100" value="50" oninput="updateTrait('initiative', this.value)">
          <div class="trait-description">
            <span class="trait-desc-left">è¢«åŠ¨å€¾å¬</span>
            <span class="trait-desc-right">ä¸»åŠ¨äº¤æµ</span>
          </div>
        </div>

        <div class="trait-item">
          <div class="trait-header">
            <span class="trait-label">åˆ›é€ åŠ›</span>
            <span class="trait-value" id="creativityValue">50</span>
          </div>
          <input type="range" class="trait-slider" id="creativity" min="0" max="100" value="50" oninput="updateTrait('creativity', this.value)">
          <div class="trait-description">
            <span class="trait-desc-left">ä¼ ç»Ÿä¿å®ˆ</span>
            <span class="trait-desc-right">åˆ›æ–°å¤§èƒ†</span>
          </div>
        </div>
      </div>

      <!-- è‡ªå®šä¹‰æè¿° -->
      <div class="custom-section">
        <h3 class="section-title">è¡¥å……æ€§æ ¼æè¿°ï¼ˆå¯é€‰ï¼‰</h3>
        <textarea
          id="customPersonality"
          class="custom-textarea"
          placeholder="ä½ å¯ä»¥åœ¨è¿™é‡Œè¯¦ç»†æè¿°ä½ æœŸæœ›çš„æ•°å­—äººæ€§æ ¼ç‰¹ç‚¹ï¼Œæ¯”å¦‚ï¼šå¸Œæœ›Taåœ¨æˆ‘å¿ƒæƒ…ä¸å¥½æ—¶èƒ½å®‰æ…°æˆ‘ï¼Œåœ¨æˆ‘éœ€è¦å»ºè®®æ—¶èƒ½ç»™å‡ºä¸“ä¸šæ„è§..."
        ></textarea>
      </div>
    </div>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <footer class="create-footer">
      <div class="footer-left">
        <button class="btn btn-text" onclick="saveDraft()">
          ğŸ’¾ ä¿å­˜è‰ç¨¿
        </button>
      </div>
      <div class="footer-right">
        <button class="btn btn-secondary" onclick="window.location.href='create-dh-step1.html'">
          ä¸Šä¸€æ­¥
        </button>
        <button class="btn btn-primary" id="nextBtn" onclick="goToNextStep()">
          ä¸‹ä¸€æ­¥
        </button>
      </div>
    </footer>
  </div>

  <script>
    // åŠ è½½æ•°æ®
    let dhData = JSON.parse(sessionStorage.getItem('create_dh_data') || '{}');

    // é¢„è®¾æ€§æ ¼é…ç½®
    const personalityPresets = {
      gentle: { liveliness: 40, humor: 30, empathy: 90, initiative: 50, creativity: 40 },
      energetic: { liveliness: 90, humor: 70, empathy: 60, initiative: 80, creativity: 70 },
      intellectual: { liveliness: 30, humor: 40, empathy: 50, initiative: 60, creativity: 60 },
      humorous: { liveliness: 70, humor: 90, empathy: 60, initiative: 70, creativity: 80 },
      calm: { liveliness: 20, humor: 30, empathy: 70, initiative: 40, creativity: 40 },
      creative: { liveliness: 60, humor: 60, empathy: 50, initiative: 70, creativity: 95 }
    };

    // æ¢å¤å·²ä¿å­˜çš„æ•°æ®
    if (dhData.personality) {
      const card = document.querySelector(`[data-personality="${dhData.personality}"]`);
      if (card) {
        card.classList.add('selected');
      }
    }

    if (dhData.traits) {
      Object.keys(dhData.traits).forEach(trait => {
        const slider = document.getElementById(trait);
        if (slider) {
          slider.value = dhData.traits[trait];
          document.getElementById(trait + 'Value').textContent = dhData.traits[trait];
        }
      });
    }

    if (dhData.customPersonality) {
      document.getElementById('customPersonality').value = dhData.customPersonality;
    }

    // é€‰æ‹©æ€§æ ¼ç±»å‹
    function selectPersonality(element) {
      // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
      document.querySelectorAll('.personality-card').forEach(card => {
        card.classList.remove('selected');
      });

      // é€‰ä¸­å½“å‰å¡ç‰‡
      element.classList.add('selected');

      // è·å–æ€§æ ¼ç±»å‹
      const personalityType = element.dataset.personality;
      dhData.personality = personalityType;

      // åº”ç”¨é¢„è®¾ç‰¹è´¨
      const preset = personalityPresets[personalityType];
      if (preset) {
        Object.keys(preset).forEach(trait => {
          const slider = document.getElementById(trait);
          if (slider) {
            slider.value = preset[trait];
            document.getElementById(trait + 'Value').textContent = preset[trait];
          }
        });

        dhData.traits = { ...preset };
      }

      sessionStorage.setItem('create_dh_data', JSON.stringify(dhData));
    }

    // æ›´æ–°ç‰¹è´¨å€¼
    function updateTrait(traitName, value) {
      document.getElementById(traitName + 'Value').textContent = value;

      if (!dhData.traits) {
        dhData.traits = {};
      }

      dhData.traits[traitName] = parseInt(value);
      sessionStorage.setItem('create_dh_data', JSON.stringify(dhData));
    }

    // ä¿å­˜è‡ªå®šä¹‰æè¿°
    document.getElementById('customPersonality').addEventListener('input', function() {
      dhData.customPersonality = this.value;
      sessionStorage.setItem('create_dh_data', JSON.stringify(dhData));
    });

    // ä¿å­˜è‰ç¨¿
    function saveDraft() {
      dhData.isDraft = true;
      dhData.lastSaved = new Date().toISOString();

      const drafts = JSON.parse(localStorage.getItem('mindpal_dh_drafts') || '[]');
      const existingIndex = drafts.findIndex(d => d.draftId === dhData.draftId);

      if (existingIndex >= 0) {
        drafts[existingIndex] = dhData;
      } else {
        dhData.draftId = dhData.draftId || Date.now();
        drafts.push(dhData);
      }

      localStorage.setItem('mindpal_dh_drafts', JSON.stringify(drafts));
      alert('è‰ç¨¿å·²ä¿å­˜ï¼');
    }

    // ä¸‹ä¸€æ­¥
    function goToNextStep() {
      // æ”¶é›†å½“å‰ç‰¹è´¨å€¼
      if (!dhData.traits) {
        dhData.traits = {
          liveliness: parseInt(document.getElementById('liveliness').value),
          humor: parseInt(document.getElementById('humor').value),
          empathy: parseInt(document.getElementById('empathy').value),
          initiative: parseInt(document.getElementById('initiative').value),
          creativity: parseInt(document.getElementById('creativity').value)
        };
      }

      dhData.customPersonality = document.getElementById('customPersonality').value;
      dhData.currentStep = 3;
      sessionStorage.setItem('create_dh_data', JSON.stringify(dhData));
      window.location.href = 'create-dh-step3.html';
    }
  </script>
</body>
</html>
